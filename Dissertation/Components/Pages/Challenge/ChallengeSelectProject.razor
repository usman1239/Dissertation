@page "/challenge/select-project"
@rendermode InteractiveServer
@inject ChallengeDashboardViewModel ViewModel
@using Dissertation.View_Models
@using Microsoft.AspNetCore.Authorization
@inherits LayoutComponentBase
@attribute [Authorize]

<link href="Styles/Main.css" rel="stylesheet"/>
<link href="Styles/Home.css" rel="stylesheet"/>
<link rel="stylesheet" href="Styles/Challenge/Shared.css"/>
<link rel="stylesheet" href="Styles/Challenge/SelectProject.css"/>


<MudPaper Class="mud-paper">
	<MudText Typo="Typo.h4" Align="Align.Center" Class="mud-text typography-h4">Select a Project</MudText>

	@if (ViewModel.ProjectViewModel.SavedProjects.Any())
	{
		<MudText Typo="Typo.h5" Align="Align.Center" Class="mud-text typography-h5">Continue Saved Projects</MudText>

		<MudList T="string" Class="mud-list">
			@foreach (var project in ViewModel.ProjectViewModel.SavedProjects)
			{
				<MudListItem Class="mud-list-item">
					<MudText Typo="Typo.h6" Class="mud-text typography-h6">@project.Project.Title</MudText>
					<MudText Typo="Typo.body2" Class="mud-text typography-body2">@project.Project.Description</MudText>
					<MudText Typo="Typo.body2" Class="mud-text typography-body2">
						<strong>Difficulty:</strong>
						@(project.Project.NumOfSprints <= 5 ? "Easy" :
						project.Project.NumOfSprints <= 10 ? "Medium" : "Hard")
					</MudText>
					<MudText Typo="Typo.body2" Class="mud-text typography-body2"><strong>Budget:</strong> £@project.Budget</MudText>

					<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="() => ViewModel.ProjectViewModel.SelectProject(project.ProjectId, true)" Class="mud-button color-primary">
						Continue
					</MudButton>
					<MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="() => ViewModel.ProjectViewModel.DeleteSavedProjectInstanceAsync(project.ProjectId)" Class="mud-button color-error">
						Delete
					</MudButton>
				</MudListItem>
			}
		</MudList>
	}

	<MudDivider Class="mud-divider"/>

	<MudText Typo="Typo.h5" Align="Align.Center" Class="mud-text typography-h5">Choose A New Project</MudText>

	<MudList T="string" Class="mud-list">
		@foreach (var project in ViewModel.ProjectViewModel.AvailableProjects)
		{
			<MudListItem Class="mud-list-item">
				<MudText Typo="Typo.h6" Class="mud-text typography-h6">@project!.Title</MudText>
				<MudText Typo="Typo.body2" Class="mud-text typography-body2">@project!.Description</MudText>
				<MudText Typo="Typo.body2" Class="mud-text typography-body2">
					<strong>Difficulty:</strong>
					@(project!.NumOfSprints <= 5 ? "Easy" :
					project.NumOfSprints <= 10 ? "Medium" : "Hard")
				</MudText>
				<MudText Typo="Typo.body2" Class="mud-text typography-body2"><strong>Budget:</strong> £@project!.Budget</MudText>

				<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="() => ViewModel.ProjectViewModel.SelectProject(project.Id, false)" Class="mud-button color-primary">
					Select
				</MudButton>
			</MudListItem>
		}
	</MudList>
</MudPaper>

@code {

	protected override async Task OnInitializedAsync()
	{
		await ViewModel.ProjectViewModel.GetUser();
		await ViewModel.ProjectViewModel.LoadProjectsWithSavedProgress();
		await ViewModel.ProjectViewModel.LoadAvailableProjectsAsync();
	}

}